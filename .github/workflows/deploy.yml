name: Deploy the project 

on:
  push:
    branches:
      - main  # or replace with your branch name

jobs:
  deploy:
    runs-on: ubuntu-latest
    container:
      image: node:20

    steps:
    - uses: actions/checkout@v3
      with:
        node-version: '20'
    - run: npm install
    - run: npm run build
    - name: Setup SSH
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
    - run: | 
       ssh -i ~/.ssh/id_rsa ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} << 'EOF'
        cd ~/node_app           # This is your project folder on the server
        git pull origin main
        npm install
        pm2 restart 0
        EOF



        

